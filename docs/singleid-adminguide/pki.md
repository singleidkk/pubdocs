**SingleID 管理者ポータル＞認証＞証明書**画面では、以下の証明書に関する操作を行うことができます。

* ルートCAおよび中間CAの証明書のダウンロード
* 証明書失効リスト（CRL）のダウンロード
* クライアント証明書プロファイルの登録/編集/削除
* 証明書情報の閲覧/検索
* 証明書のダウンロード/更新/失効
* クライアント証明書のダウンロードリンク送信
* サーバ証明書の発行

## 基本情報
**SingleID 管理者ポータル＞認証＞証明書**画面の**基本情報**タブでは、以下の３つのブロックがあります。

1. **ルートCA**のブロック

    ルートCAの証明書の情報です。
    ルートCAのタイトル文字の隣の:fontawesome-solid-cloud-arrow-down:をクリックすることで、ルートCAの証明書をダウンロードできます。

2. **中間CA**のブロック
    
    中間CAの証明書の情報です。
    中間CAのタイトル文字の隣の:fontawesome-solid-cloud-arrow-down:をクリックすることで、中間CAの証明書をダウンロードできます。
    失効リスト配布ポイントの隣の:fontawesome-solid-cloud-arrow-down:をクリックすることで、証明書失効リスト（CRL）をダウンロードできます。

    !!! info
        証明書が失効された場合、証明書失効リスト（CRL）は**即時に更新**されます。更新された証明書失効リスト（CRL）の有効期間は、**10日間**です。
    !!! warning
        お客様のシステムによっては、証明書失効リスト（CRL）の有効期限が切れるまで、証明書失効リスト（CRL）をダウンロードしない場合があります。その場合、証明書が失効されても、システム側でクライアント証明書での認証が成功してしまいます。システムに、証明書失効リスト（CRL）を定期的にダウンロードする機能がある場合には、その機能を使用して、定期的（1時間ごとなど）にダウンロードすることをお勧めします。

3. **証明書の統計**のブロック

    以下の統計情報が表示されます。有効期限が近づいているクライアント証明書について、必要に応じて、更新処理の計画をしてください。

    * 1ヶ月以内に有効期限が切れるクライアント証明書数
    * 3ヶ月以内に有効期限が切れるクライアント証明書数
    * 有効期限内のクライアント証明書数
    * 失効されたクライアント証明書数
    * 一人当たりのクライアント証明書の平均発行数

## クライアント証明書のプロファイル
**SingleID 管理者ポータル＞認証＞証明書**画面の**プロファイル**タブでは、クライアント証明書のプロファイルの設定を行います。設定されたクライアント証明書のプロファイルにしたがって、クライアント証明書が発行されます。初期状態では、デフォルトで定義されたプロファイルが使用されて、クライアント証明書が発行されます。

デフォルトのプロファイルの初期値は以下です。

| **設定項目** | **設定値** |
| :--- | :--- |
| **組織単位/OU(英字)** | 未定義 |
| **有効期間** | 10年間 |
| **拡張キー使用法（EKU）** | クライアント認証 |
| **サブジェクトの代替名** | メールアドレス |

### クライアント証明書のプロファイルの登録
1. **登録**ボタンをクリックします。
2. **プロファイル登録**画面がポップアップします。
3. 以下を設定します。

    * **プロファイル名**：任意です。
    * **デフォルトプロファイル**：有効にすると、クライアント証明書を発行するときのデフォルトとして使用されます。
    * **組織単位/OU(英字)**：任意です。
    * **有効期間**：1年、5年、10年から選択します。
    * 以下、**拡張キー使用法（EKU）**と**サブジェクトの代替名**の推奨値です。
        
        | **拡張キー使用法（EKU）** | **サブジェクトの代替名** |
        | :--- | :--- |
        | **クライアント認証**の場合 | **設定は任意** |
        | **スマートログオン**の場合 | **UPNの設定は必須** |
        | **電子メールの保護**の場合 | **メールアドレスの設定は必須** |

4. **登録**をクリックして、証明書のプロファイルを登録します。

### クライアント証明書のプロファイルの編集
1. 変更したプロファイルの列にある**編集**ボタンをクリックします。
2. **プロファイル編集**画面がポップアップします。
3. 項目を変更して、**変更**ボタンをクリックして、変更を保存します。

### クライアント証明書のプロファイルの削除
1. 削除したいプロファイルの列にある**削除**ボタンをクリックします。
2. **プロファイル削除**画面がポップアップします。
3. **削除**ボタンをクリックして、プロファイルを削除します。

## 証明書
**SingleID 管理者ポータル＞認証＞証明書**画面の**証明書**タブでは、クライアントおよびサーバ証明書情報の閲覧/検索、証明書のダウンロード/更新/失効、クライアント証明書のダウンロードリンク送信、サーバ証明書の発行を行います。

### クライアント証明書の発行
クライアント証明書の発行は、**SingleID 管理者ポータル＞ユーザ一覧**画面から行います。

### サーバ証明書の発行
リモートアクセスVPNの認証にSingleIDのクライアント証明書を使用する場合、クライアント証明書と同じCAで署名したサーバ証明書をVPN装置にインポートすることが要求される場合があります。

1. **発行**ボタンをクリックし、**サーバ証明書**を選択します。
2. **サーバ証明書の発行**画面がポップアップします。
3. 以下を設定します。

    | **項目** | **説明** |
    | :--- | :--- |
    | **サーバ名** | IPアドレスまたはホスト名（FQDN）です。 |
    | **サブジェクトの代替名** | サーバ名にIPアドレスを設定した場合には、IPを選択します。サーバ名にホスト名を設定した場合には、DNSを選択します。 |
    | **有効期間** | 1年、5年、10年から選択します。 |

4. **登録**ボタンをクリックして、サーバ証明書を発行します。

### 証明書情報の閲覧および検索
以下の事前定義検索フィルタおよび証明書の属性で証明書を検索し表示することができます。

**事前定義検索フィルタ**

* １か月以内に有効期限が切れる証明書一覧
* ３か月以内に有効期限が切れる証明書一覧

**検索可能な属性**

* ユーザ名/サーバ名
* 証明書のシリアル番号
* 証明書のインストール日時
* 証明書の終了日時
* 証明書の失効日時
* 証明書の登録日時

### クライアント証明書のダウンロードリンク送信
クライアント証明書のダウンロードリンクをユーザのメールアドレス宛に送信します。

1. 送信したい証明書の列にある**チェックボックス**を選択します。（複数選択可能）
2. **選択実行**ボタンの▼をクリックし、プルダウンメニューの**証明書のメール送信**を選択します。
3. **証明書メール送信**画面がポップアップします。
4. 配布形式を選択します。

    * 一般・・・PKCS#12形式(拡張子P12)またはApple構成プロファイル形式（拡張子mobileconfig）
    * Windows自動構成・・・Windows10/11へ証明書を自動でインストールするツール

5. **送信**ボタンをクリックして、証明書のダウンロードリンクをメールで送信します。

!!! info
    発行されたクライアント証明書をデバイスへインストールする場合には、パスワードの入力が要求されます。パスワードは、ユーザ名と同一です。（例：ユーザ名がuser1の場合、クライアント証明書のパスワードは、user1です。）

!!! warning
    * メール送信可能な期間は、クライアント証明書を発行してから**1か月間**です。
    * メールで送信されたダウンロードリンクの有効期間は、**１週間**です。
    * Windowsの自動構成を利用して、証明書をインストールすると、メールで送信されたダウンロードリンクは無効となります。

### 証明書のダウンロード
**PKCS#12形式(拡張子P12)**のクライアントおよびサーバ証明書をZIP圧縮してダウンロードします。

1. ダウンロードしたい証明書の列にある**チェックボックス**を選択します。（複数選択可能）
2. **選択実行**ボタンの▼をクリックし、プルダウンメニューの**証明書のダウンロード**を選択します。
3. **証明書ダウンロード**画面がポップアップします。
4. **ダウンロード**ボタンをクリックして、証明書をダウンロードします。

!!! info
    発行された証明書をデバイスへインストールする場合には、パスワードの入力が要求されます。パスワードは、ユーザ名/サーバ名と同一です。（例：ユーザ名がuser1の場合、クライアント証明書のパスワードは、user1です。サーバ名が10.10.10.10の場合、サーバ証明書のパスワードは、10.10.10.10です。）

!!! warning
    ダウンロード可能な期間は、証明書を発行してから**1か月間**です。１か月が過ぎた証明書をダウンロードしようとした場合には、ZIP圧縮ファイルの中に、「ユーザ名/サーバ名.txt」ファイルが作成されています。

### 証明書の更新
既存のクライアントおよびサーバ証明書と同一情報で、有効期限を延長して証明書を発行します。

1. 更新したい証明書の列にある**チェックボックス**を選択します。（複数選択可能）
2. **選択実行**ボタンの▼をクリックし、プルダウンメニューの**証明書の更新**を選択します。
3. **証明書更新**画面がポップアップします。
4. **更新**ボタンをクリックして、証明書を更新します。

!!! info
    * 証明書のシリアル番号は既存の証明書と異なります。
    * 既存の証明書は失効されません。

### 証明書の失効
クライアントおよびサーバ証明書を失効します。

1. 失効したい証明書の列にある**チェックボックス**を選択します。（複数選択可能）
2. **選択実行**ボタンの▼をクリックし、プルダウンメニューの**証明書の失効**を選択します。
3. **証明書失効**画面がポップアップします。
4. **失効**ボタンをクリックして、証明書を失効します。

!!! warning
    * 証明書が失効されたら、即時、証明書失効リスト（CRL）に証明書のシリアル番号が追加されます。
    * 失効された証明書を有効化することはできません。

### クライアント証明書のインストール日時の更新

デバイスごとに異なるクライアント証明書をインストールしたい場合があります。手動または自動で行うことができます。インストール日時が更新された証明書をダウンロードすることはできなくなります。

#### 手動でインストール日時を設定する場合

1. クライアント証明書をデバイスへインストールします。
2. インストール後に、**SingleID 管理者ポータル＞認証＞証明書**画面の**証明書**タブへ移動します。
3. インストールしたクライアント証明書を検索します。
4. インストール日時の列にある**更新**ボタンをクリックします。現在日時がインストール日時として設定されます。クライアント証明書のダウンロードおよびメール送信が不可となります。
5. 管理用として、**メモ**ボタンをクリックして、証明書をインストールしたデバイス情報を入力します。

#### 自動でインストール日時を設定する場合

クライアント証明書のWindows自動構成ツールを実行します。クライアント証明書のインストール日時の登録およびデバイス情報（Windowsマシンのユーザ名とコンピュータ名）登録が自動で行われます。