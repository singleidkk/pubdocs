# Windows 10 以降のデバイス構成プロファイルの作成方法

## 信頼された証明書
### 事前作業
SingleIDのルートCA証明書ファイルと中間CA証明書ファイルを取得します。

[取得方法](../pki.md/#基本情報)

### ルートCA証明書
1. **Microsoft Intune 管理センター＞デバイス＞デバイスの管理＞構成＞ポリシー**タブへ移動します。
2. **作成＞新しいポリシー**ボタンをクリックし、以下の内容でポリシーを作成します。

| **設定項目** | **設定内容** |
| :--- | :--- |
| **名前** | 任意です。（例: SingleIDルートCA証明書-windows） |
| **プラットフォーム** | **Windows 10 以降**を選択します。 |
| **プロファイルの種類** | **信頼された証明書（テンプレート）** |
| **証明書ファイル** | **SingleIDのルートCA証明書**ファイルを選択します。 |
| **保存先ストア** | **コンピュータ証明書ストア - ルート**を選択します。 |
| **割り当て** | 構成プロファイルを適用するグループを設定します。（例: すべてのデバイス）<br>⚠️ **注意:** 信頼された証明書とSCEP証明書は同じ割り当てを設定する必要があります。 |
| **スコープタグ** | **既定**を設定します。 |

### 中間CA証明書
1. **Microsoft Intune 管理センター＞デバイス＞デバイスの管理＞構成＞ポリシー**タブへ移動します。
2. **作成＞新しいポリシー**ボタンをクリックし、以下の内容でポリシーを作成します。

| **設定項目** | **設定内容** |
| :--- | :--- |
| **名前** | 任意です。（例: SingleID中間CA証明書-windows） |
| **プラットフォーム** | **Windows 10 以降**を選択します。 |
| **プロファイルの種類** | **信頼された証明書（テンプレート）** |
| **証明書ファイル** | **SingleIDの中間CA証明書**ファイルを選択します。 |
| **保存先ストア** | **ユーザー証明書ストア - 中間**を選択します。 |
| **割り当て** | 構成プロファイルを適用するグループを設定します。（例: すべてのデバイス）<br>⚠️ **注意:** 信頼された証明書とSCEP証明書は同じ割り当てを設定する必要があります。 |
| **スコープタグ** | **既定**を設定します。 |

## SCEP証明書
1. **Microsoft Intune 管理センター＞デバイス＞デバイスの管理＞構成＞ポリシー**タブへ移動します。
2. **作成＞新しいポリシー**ボタンをクリックし、以下の内容でポリシーを作成します。

| **設定項目** | **設定内容** |
| :--- | :--- |
| **名前** | 任意です。（例: SingleIDユーザー証明書-windows） |
| **プラットフォーム** | **Windows 10 以降**を選択します。 |
| **プロファイルの種類** | **SCEP 証明書（テンプレート）** |
| **証明書の種類** | **ユーザー**を選択します。 |
| **サブジェクト** | **CN={{UserName}},E={{EmailAddress}},O=SingleIDのアカウント番号（例: 90000013）,C=JP**を設定します。<br>⚠️ **注意:** CN、E、O、Cの4つの属性は必須属性です。OU属性は任意です。 |
| **サブジェクトの別名** | 属性: 電子メールアドレス　値: {{EmailAddress}}<br>⚠️ **注意:** サブジェクトの別名の設定は任意です。<br>サポートするサブジェクトの別名は、電子メールアドレス、ユーザープリンシパル名、DNS、IPです。それ以外の別名は無視されます。 |
| **証明書の有効期間** | 任意です。（例: 5） |
| **キー記憶域プロバイダー (KSP)** | **トラステッド プラットフォーム モジュール (TPM) KSP が存在する場合は TPM KSP に登録する (それ以外はソフトウェア KSP に登録する)**を選択します。 |
| **キー使用法** | **キーの暗号化**、**デジタル署名**を選択します。<br>⚠️ **注意:** キーの暗号化、デジタル署名のみサポートしています。ここでの設定に関係なく、キーの暗号化、デジタル署名の使用法が設定された証明書が発行されます。 |
| **キー サイズ (ビット)** | **2048**を選択します。<br>⚠️ **注意:** 2048のみサポートしています。ここでの設定に関係なく、2048ビットが設定された証明書が発行されます。 |
| **ハッシュ アルゴリズム** | **SHA-2**を選択します。<br>⚠️ **注意:** SHA-2のみサポートしています。ここでの設定に関係なく、SHA-2が設定された証明書が発行されます。 |
| **ルート証明書** | **中間CA証明書**を選択します。<br>⚠️ **注意:** ルートCA証明書ではなく、中間CA証明書を選択します。 |
| **拡張キー使用法** | **クライアント認証**を選択します。<br>⚠️ **注意:** クライアント認証のみサポートしています。ここでの設定に関係なく、クライアント認証が設定された証明書が発行されます。 |
| **更新しきい値 (%)** | 任意です。（例: 20） |
| **SCEP サーバーの URL** | **SingleIDから提供されるSCEPサーバのエンドポイントURL**を設定します。 |
| **割り当て** | 構成プロファイルを適用するグループを設定します。（例: すべてのデバイス）<br>⚠️ **注意:** 信頼された証明書とSCEP証明書は同じ割り当てを設定する必要があります。 |
| **スコープタグ** | **既定**を設定します。 |
