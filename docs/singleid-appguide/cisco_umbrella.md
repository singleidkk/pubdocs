# Cisco Umbrellaのアプリ連携
文書更新日:2025-08-27

## シングルサインオン
### SingleIDのアプリ連携設定
1. **SingleID 管理者ポータル＞アプリ連携＞アプリ一覧**画面へ移動します。
2. **カタログ表示**ボタンをクリックします。
    
    [![Screenshot](/images/2022-08-16_3-53-18.png)](/images/2022-08-16_3-53-18.png)

3. アプリカタログが表示されるので、Cisco Umbrellaの**登録**ボタンをクリックします。
    
    [![Screenshot](/images/2025-08-27_16-36-07.png)](/images/2025-08-27_16-36-07.png)

4. **アプリ登録**画面がポップアップします。**情報**タブの**名前**に、アプリを識別できるような名前を、半角小文字の**英数字**、**-（ハイフン）**、**_（アンダースコア）**で設定します。**シングルサインオン**タブに移動します。
    
    [![Screenshot](/images/2025-08-27_16-39-03.png)](/images/2025-08-27_16-39-03.png)

5.  以下の内容を設定し、**登録**ボタンをクリックして、アプリを登録します。

    | **設定項目** | **設定内容** |
    | :--- | :--- |
    | **SSO 有効/無効** | **有効**を選択します。 |
    | **IdP エンドポイントメタデータ** | **ダウンロード**ボタンをクリックし、メタデータを取得します。このメタデータは、[Cisco UmbrellaのSAML認証設定](#cisco-umbrellaのsaml認証設定)の手順を行う際に必要となります。 |
    | **証明書** | [Cisco UmbrellaのSAML認証設定](#cisco-umbrellaのsaml認証設定)の手順でダウンロードしたメタデータのファイルを開きます。<br>`<ds:X509Certificate>`タグ内のMIIで始まる文字列（例：`MIICnzCCAYcCBgF/zubcKTANBgkqhkiG9w0BAQsFADATMREwDw……..`）をコピーして、入力します。<br>**注意**: <ds:X509Certificate>のタグが2つある場合には、後の証明書を使用してください。 |    
    | **NameIDフォーマット** | **username**を入力します。 |

    [![Screenshot](/images/2025-08-27_16-50-29.png)](/images/2025-08-27_16-50-29.png)

### Cisco UmbrellaのSAML認証設定
1. Cisco UmbrellaのWeb管理コンソールへ管理者権限を持つユーザでログインします。
2. **導入＞設定＞SAML設定**画面へ移動し、右上の**追加**ボタンをクリックします。

    [![Screenshot](/images/2025-08-27_16-57-37.png)](/images/2025-08-27_16-57-37.png)

2. 以下を設定し、**次へ**ボタンをクリックします。

    | **設定項目** | **設定内容** |
    | :--- | :--- |
    | **アイデンティティ プロバイダーの選択** | **その他**を選択します。 |

    [![Screenshot](/images/2025-08-27_16-59-49.png)](/images/2025-08-27_16-59-49.png)

4. 以下を設定し、**次へ**ボタンをクリックします。

    | **設定項目** | **設定内容** |
    | :--- | :--- |
    | **Other メタデータの設定** | **XMLファイルのアップロード**を選択します。 |
    | **Umbrellaメタデータファイルのダウンロード** | **XMLファイル**をダウンロードします。[SingleIDのアプリ連携設定](#singleidのアプリ連携設定)の手順で必要となります。 |

    [![Screenshot](/images/2025-08-27_17-03-24.png)](/images/2025-08-27_17-03-24.png)

5. 以下を設定し、**次へ**ボタンをクリックします。

    | **設定項目** | **設定内容** |
    | :--- | :--- |
    | **Other メタデータXMLアップロード** | [SingleIDのアプリ連携設定](#singleidのアプリ連携設定)の手順でダウンロードしたメタデータをアップロードします。 |

    [![Screenshot](/images/2025-08-27_17-10-52.png)](/images/2025-08-27_17-10-52.png)

6. 以下を設定し、**保存**ボタンをクリックします。

    | **設定項目** | **設定内容** |
    | :--- | :--- |
    | **ユーザの再認証** | 再認証間隔を設定します。(例: 毎日) |

    [![Screenshot](/images/2025-08-27_17-14-03.png)](/images/2025-08-27_17-14-03.png)

## プロビジョニング
1. **Cisco UmbrellaのWeb管理コンソール＞導入＞コアアイデンティティ＞ユーザとグループ**画面へ移動します。
2. **Manual Import**から、ユーザ情報のCSVファイルをインポートします。

    !!! info
        インポート用のCSVファイルを準備するには、SingleIDのユーザCSVファイルをご活用ください。**SingleID 管理者ポータル＞ユーザ一覧**画面からユーザ情報をCSVファイルでエクスポートできます。

    [![Screenshot](/images/2025-08-27_17-19-38.png)](/images/2025-08-27_17-19-38.png)

## アプリにユーザ追加
1. **SingleID 管理者ポータル＞アプリ連携＞アプリ一覧**画面へ移動します。
2. 登録したアプリの列にある**チェックボックス**を選択します。
3. **ユーザ追加**ボタンをクリックします。
    
    [![Screenshot](/images/image-4.png)](/images/image-4.png)

4. **ユーザ追加**画面がポップアップします。アプリへ追加したい**ユーザ名**を選択し、**登録**ボタンをクリックして、アプリへユーザを追加します。
    
    [![Screenshot](/images/image-5.png)](/images/image-5.png)

## 動作確認
### SAML連携テスト 
1. **Cisco UmbrellaのWeb管理コンソール＞導入＞設定＞SAML設定**画面へ移動します。**テスト構成**ボタンをクリックします。

    [![Screenshot](/images/2025-08-27_17-32-41.png)](/images/2025-08-27_17-32-41.png)

3. SingleIDのログイン画面が表示されます。すでに、SingleIDへログイン中であれば、ログイン画面は表示されません。
   
    [![Screenshot](/images/image-7-1024x462.png)](/images/image-7-1024x462.png)

4. SingleIDの認証に成功すると**SAML Configuration Test completed successfully.**と表示されます。
    [![Screenshot](/images/2025-08-27_17-36-27.png)](/images/2025-08-27_17-36-27.png)
