# Synology NASのアプリ連携
文書更新日:2025-03-14

!!! info
    以下で動作確認を行いました。
    **機種**: DS224+
    **DiskStation Managerのバージョン**: 7.2.2

## シングルサインオン
### SingleIDのアプリ連携設定
1. **SingleID 管理者ポータル＞アプリ連携＞アプリ一覧**画面へ移動します。
2. **カタログ表示**ボタンをクリックします。
    
    [![Screenshot](/images/2022-08-16_3-53-18.png)](/images/2022-08-16_3-53-18.png)

3. アプリカタログが表示されるので、Synology NASの**登録**ボタンをクリックします。
    
    [![Screenshot](/images/2025-03-14_13-41-31.png)](/images/2025-03-14_13-41-31.png)

4. **アプリ登録**画面がポップアップします。**情報**タブの**名前**に、アプリを識別できるような名前を、半角小文字の**英数字**、**-（ハイフン）**、**_（アンダースコア）**で設定します。**シングルサインオン**タブに移動します。
    
    [![Screenshot](/images/2025-03-14_13-50-10.png)](/images/2025-03-14_13-50-10.png)

5.  以下の内容を設定し、**登録**ボタンをクリックして、アプリを登録します。

    | **設定項目** | **設定内容** |
    | :--- | :--- |
    | **SSO 有効/無効** | **有効**を選択します。 |
    | **IdP エンドポイントメタデータ** | **ダウンロード**ボタンをクリックし、メタデータを取得します。このメタデータは、[Synology NASのSAML認証設定](#synology-nasのsaml認証設定)の手順を行う際に必要となります。 |
    | **SPのエンティティID** | [Synology NASのSAML認証設定](#synology-nasのsaml認証設定)の手順の**SP エンティティ ID**に設定した内容を設定します。 |
    | **NameIDフォーマット** | **username**を入力します。 |

    [![Screenshot](/images/2025-03-14_13-54-09.png)](/images/2025-03-14_13-54-09.png)

### Synology NASのSAML認証設定
1. **Synology NAS GUI＞コントロールパネル＞ドメイン/LDAP＞SSOクライアント**タブへ移動します。
2. **SAML SSO サービスを有効化**の**チェックボックス**を選択して、**SAML SSO 設定**ボタンをクリックします。**SAML SSO 設定**画面がポップアップします。

    [![Screenshot](/images/2025-03-12_18-03-24.png)](/images/2025-03-12_18-03-24.png)

3. **メタデータのインポート**ボタンをクリックし、[SingleIDのアプリ連携設定](#singleidのアプリ連携設定)の手順でダウンロードしたメタデータをインポートします。以下の内容で設定し、**保存**ボタンをクリックします。

    | **設定項目** | **設定内容** |
    | :--- | :--- |
    | **名前** | ログイン画面の表示名を設定します。（例：SingleID）|
    | **アカウントタイプ** | **ドメイン/LDAP/ローカル**を選択します。 |
    | **SP エンティティ ID** | Synology NASのログインURLです。**https://**で指定します。 |
    | **IDP エンティティ ID** | SingleIDのメタデータをインポートしたことで自動入力されます。<br><br>（例：`https://auth-02-0001.poc.singleid.jp/auth/realms/90000013`） |
    | **IDP シングルサインオン URL** | SingleIDのメタデータをインポートしたことで自動入力されます。<br><br>（例：`https://auth-02-0001.poc.singleid.jp/auth/realms/90000013/protocol/saml`） |
    | **応答署名認証** | **SAML 応答に署名**を選択します。 |
    | **証明書** | SingleIDのメタデータをインポートしたことで同時に証明書もインポートされます。証明書の有効期限が表示されます。 |

    [![Screenshot](/images/2025-03-14_14-28-18.png)](/images/2025-03-14_14-28-18.png)

## プロビジョニング
Synology NASのプロビジョニングには対応していません。SingleIDのユーザ名と同一のユーザ名を手動で、Synology NASへ登録します。

## アプリにユーザ追加
1. **SingleID 管理者ポータル＞アプリ連携＞アプリ一覧**画面へ移動します。
2. 登録したアプリの列にある**チェックボックス**を選択します。
3. **ユーザ追加**ボタンをクリックします。
    
    [![Screenshot](/images/image-4.png)](/images/image-4.png)

4. **ユーザ追加**画面がポップアップします。アプリへ追加したい**ユーザ名**を選択し、**登録**ボタンをクリックして、アプリへユーザを追加します。
    
    [![Screenshot](/images/image-5.png)](/images/image-5.png)

## 動作確認方法
1. Synology NASのログイン画面へアクセスします。**SSO認証**タブをクリックします。**→**をクリックしてSAML認証を行います。

    [![Screenshot](/images/2025-03-14_14-53-11.png)](/images/2025-03-14_14-53-11.png)
    
2. SingleIDのログイン画面が表示されます。すでに、SingleIDへログイン中であれば、ログイン画面は表示されず、Synology NASへログインできます。
    
    [![Screenshot](/images/image-7-1024x462.png)](/images/image-7-1024x462.png)
