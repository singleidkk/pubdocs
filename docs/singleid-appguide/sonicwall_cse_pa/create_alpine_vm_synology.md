# Synology NASにAlpine Linuxの仮想マシンを構築する手順
文書更新日:2025-03-20

## Virtual Machine Managerとは
Virtual Machine Managerは、Synology NAS上で複数の仮想マシンを簡単に構築・実行・管理できる統合インターフェイスを提供します。これにより、ハードウェアリソースの柔軟な割り当て、企業向け仮想環境の構築、ホスト間のシームレスな仮想マシン移行、および高い耐障害性が実現されます。

* [**仕様・制限**](https://www.synology.com/ja-jp/dsm/7.2/software_spec/vmm){target=_blank}
* [**適用機種**](https://www.synology.com/ja-jp/dsm/packages/Virtualization){target=_blank}
* [**システム要件**](https://kb.synology.com/ja-jp/DSM/tutorial/How_many_virtual_machines_can_I_run_on_my_Synology_NAS){target=_blank}

## 手順
以下の環境で確認した手順です。

| **項目** | **内容** |
| :-- | :-- |
| **機種** | DS224+（搭載メモリ: 2GB） |
| **DSMバージョン** | 7.2.2-72806 |

### Virtual Machine Managerのインストール

1. DiskStation Manager（DSM）に管理者でログインします。
2. **DSM＞パッケージマネージャー**画面で、**Virtual Machine Manager**を検索し、インストールボタンをクリックします。

    [![Screenshot](/images/2025-03-16_9-32-22.png)](/images/2025-03-16_9-32-22.png)

3. インストールが完了すると、**Virtual Machine Manager 設定ウィザード**画面で、**起動**ボタンをクリックします。
4. **ホスト設定をチェック**画面が表示されます。**次へ**ボタンをクリックします。

    !!! info
        適用機種のSynologoy NASであっても、搭載メモリが2GBの場合には、**コンピュータノード**が不適格と表示されます。不適格と表示されても、そのまま、**次へ**ボタンをクリックします。Alpine Linuxに割り当てるメモリは256MBなので、搭載メモリが2GBのままでも、仮想マシンを作成できます。

    [![Screenshot](/images/2025-03-16_9-35-20.png)](/images/2025-03-16_9-35-20.png)

5. **はい**ボタンをクリックし、**Open vSwitch**を有効化します。

    [![Screenshot](/images/2025-03-16_9-36-13.png)](/images/2025-03-16_9-36-13.png)

6. **ボリュームの選択**画面が表示されます。ボリュームを選択し、**次へ**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_9-36-40.png)](/images/2025-03-16_9-36-40.png)

7. 仮想クラスタが構築されます。**終了**ボタンをクリックします。
 
    [![Screenshot](/images/2025-03-16_9-43-52.png)](/images/2025-03-16_9-43-52.png)

### Alpine LinuxのISOイメージのダウンロード
Alpine Linuxの[ダウンロードページ](https://alpinelinux.org/downloads/){target=_blank}へアクセスします。Synology **STANDARD**の**x86_64**のISOイメージをダウンロードします。

### Virtual Machine ManagerへAlpine LinuxのISOイメージをアップロード
1. **DSM＞Virtual Machine Manager＞イメージ＞ISOファイル**タブへ移動します。
2. **追加**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_10-10-39.png)](/images/2025-03-16_10-10-39.png)

3. **コンピュータ**を選択し、**次へ**ボタンをクリックします。[Alpine LinuxのISOイメージのダウンロード](#alpine-linuxのisoイメージのダウンロード)の手順でダウンロードしたISOイメージを選択します。

    [![Screenshot](/images/2025-03-16_10-10-59.png)](/images/2025-03-16_10-10-59.png)

4. ISOイメージを保存するストレージを選択し、**完了**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_10-11-58.png)](/images/2025-03-16_10-11-58.png)

### Alpine Linuxの仮想マシンの作成
1. **DSM＞Virtual Machine Manager＞仮想マシン**画面へ移動します。**作成**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_11-05-22.png)](/images/2025-03-16_11-05-22.png)

2. **オペレーティングシステムの選択**画面で、**Linux**を選択し、**次へ**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_11-05-44.png)](/images/2025-03-16_11-05-44.png)

3. **ストレージを選択**画面で、仮想マシンで使用する**ストレージ**を選択し、**次へ**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_11-06-18.png)](/images/2025-03-16_11-06-18.png)

4. **一般仕様を構成**画面で、以下の内容を設定し、次へボタンをクリックします。

    | **設定項目** | **設定内容** |
    | :-- | :-- |
    | **名前** | 仮想マシンの名前を設定します。（例：Alpine Linux） |
    | **CPU** | **1**を設定します。 |
    | **メモリ** | **256MB**を設定します。 |
    | **ビデオ カード** | ***vga**を選択します。 |
    | **マシン タイプ** | **PC**を選択します。 |
    | **仮想マシンの優先順位** | **正常**を選択します。 |

    [![Screenshot](/images/2025-03-16_11-09-26.png)](/images/2025-03-16_11-09-26.png)

5. **ストレージ**画面で、**10GB**を設定し、**次へ**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_11-10-02.png)](/images/2025-03-16_11-10-02.png)

6. **ネットワークを構成**画面で、**Default VM Network**を選択し、**次へ**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_11-10-24.png)](/images/2025-03-16_11-10-24.png)

7. **その他の設定**画面で、以下の内容を設定し、**次へ**ボタンをクリックします。

    | **設定項目** | **設定内容** |
    | :-- | :-- |
    | **ブートアップ用のISOファイル** | [Virtual Machine ManagerへAlpine LinuxのISOイメージをアップロード](#virtual-machine-managerへalpine-linuxのisoイメージをアップロード)の手順でアップロードしたISOファイルを選択します。 |
    | **自動スタート** | **はい**を選択します。 |
    | **キーボードレイアウト** | **ja**を選択します。 |

    [![Screenshot](/images/2025-03-16_11-12-03.png)](/images/2025-03-16_11-12-03.png)

8. **電源管理許可**画面で、管理を許可したいユーザを選択し、**次へ**ボタンをクリックします。
9. **要約**画面で、**構築後に仮想マシンの電源を入れる**のチェックボックスにチェックし、**完了**ボタンをクリックします。

    [![Screenshot](/images/2025-03-16_11-13-37.png)](/images/2025-03-16_11-13-37.png)

### Alpine Linuxのインストール
1. **DSM＞Virtual Machine Manager＞仮想マシン**画面へ移動します。作成した仮想マシンが起動していることを確認し、**接続**ボタンをクリックします。

    [![Screenshot](/images/2025-03-17_14-35-45.png)](/images/2025-03-17_14-35-45.png)

2. **コンソール**画面が表示されます。
3. 以下でログインします。

    | **設定項目** | **設定内容** |
    | :-- | :-- |
    | **ユーザ名** | root |
    | **パスワード** | なし |

4. `setup-alpine`を入力し、インストールを開始します。
5. **Keymap**の設定です。**jp**を設定します。

    [![Screenshot](/images/2025-03-17_14-43-33.png)](/images/2025-03-17_14-43-33.png)

6. **Hostname**の設定です。デフォルトの**localhost**を設定します。

    [![Screenshot](/images/2025-03-17_14-45-33.png)](/images/2025-03-17_14-45-33.png)

7. **Interface**の設定です。Synology NASが設置されているLANがDHCP環境の場合は、デフォルトの**eth0**を**DHCP**に設定します。DHCP環境ではない場合は、IP、ネットマスク、デフォルトゲートウェイ、DNSの設定を手動で行います。

    !!! info
        LAN用のローカルDNSゾーン（例： example.local）がある場合には、そのゾーンのDNS情報を参照できるDNSサーバを設定する必要があります。

    [![Screenshot](/images/2025-03-17_14-49-13.png)](/images/2025-03-17_14-49-13.png)

8. **Root Password**の設定です。

    !!! info
        英大文字、英小文字、数字、記号を組み合わせて、最低でも14文字以上の複雑な文字列を設定することをお勧めします。

    [![Screenshot](/images/2025-03-17_14-55-31.png)](/images/2025-03-17_14-55-31.png)

9.  **Timezone**の設定です。**Japan**を設定します。

    [![Screenshot](/images/2025-03-20_18-22-50.png)](/images/2025-03-20_18-22-50.png)

10. **Proxy**の設定です。デフォルトの**None**を設定します。

    [![Screenshot](/images/2025-03-17_15-00-09.png)](/images/2025-03-17_15-00-09.png)

11. **APK Mirror**の設定です。インストールするパッケージは少数なので、速度を気にする必要はありません。デフォルトの**1**を設定します。

    [![Screenshot](/images/2025-03-17_15-01-54.png)](/images/2025-03-17_15-01-54.png)

12. **User**の設定です。ユーザを作成しません。ただし、SSHサービスを有効にし、rootログインができるように設定します。

    !!! danger
        **必要な設定が完了したら、SSHサービスを停止してください。**rootユーザで、SSHログインを許可することはセキュリティ上勧められません。ここでは、ブラウザのコンソール画面での設定がコピー＆ペーストが行えないなど、不便なため一時的に有効にしています。

    [![Screenshot](/images/2025-03-17_15-04-36.png)](/images/2025-03-17_15-04-36.png)

13. **Disk & Install**の設定です。[Alpine Linuxの仮想マシンの作成](#alpine-linuxの仮想マシンの作成)の手順で、仮想マシンに割り当てたディスクを入力します。（例：sda）この仮想マシンのディスクは初期化されデータは消去されます。

    [![Screenshot](/images/2025-03-17_15-13-06.png)](/images/2025-03-17_15-13-06.png)

14. `setup-ntp`を入力し、NTPによる時間同期の設定を行います。デフォルトの**chrony**を設定します。

    [![Screenshot](/images/2025-03-20_18-31-01.png)](/images/2025-03-20_18-31-01.png)

15. インストールを完了するために、**reboot**コマンドを実行し仮想マシンを再起動します。
