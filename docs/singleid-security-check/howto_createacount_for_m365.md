# M365の検査アカウントの作成方法

M365の検査には以下の情報が必要となります。

| **名称** | **説明** |
| :-- | :-- |
| テナントID | 監査対象のテナントID |
| アプリケーションID | 監査用アプリケーションID |
| クライアントシークレット | 認証用の資格情報 |
| アカウント | 診断用アカウントのユーザー名 |
| パスワード | 診断用アカウントのパスワード |
| 契約プラン | 契約しているM365の契約プラン |

## テナントIDの確認
1. [Microsoft 365管理センター](https://admin.microsoft.com)に管理者ユーザでサインインし、左ペインの**AzureActiveDerectory**に遷移します。

    !!! note
        項目が隠れている場合、**すべて表示**を選択し一覧表示してください。

2. 基本情報欄の**テナントID**の値を控えます。申請時に必要な情報になります。**【テナントID欄】**
    
    !!! example
        例：af53a412-f17e-4d84-8294-xxxxxxxxxxxx
    
    [![Screenshot](/images/2023-08-13_15-39-34.png)](/images/2023-08-13_15-39-34.png)

## アプリケーションの登録
1. 左ペインの**アプリケーション＞アプリの登録**に移動します。
2. **新規登録**を選択し、以下のように設定し、**登録**をクリックします。

    <table>
        <tr>
            <th>名前</th>
            <td>任意の文字列　※m365-scan-test　など</td>
        </tr>
        <tr>
            <th>サポートされているアカウントの種類</th>
            <td>この組織ディレクトリのみに含まれるアカウント  (既定のディレクトリ のみ - シングル テナント)</td>
        </tr>
        <tr>
            <th>リダイレクト URI</th>
            <td>パブリック クライアント/ネイティブ（モバイルとデスクトップ）
	https://163.43.26.119:8834</td>
        </tr>
    </table>

3. 登録したアプリの**詳細画面**に戻り、先ほど登録したアプリケーション「例：m365-scan-test」の**アプリケーション（クライアント）ID**の値を控えます。申請時に必要な情報になります。**【アプリケーションID 欄】**

    !!! example
        例：a2a84bbe-ef1b-4344-9590-xxxxxxxxxxxx
        
    [![Screenshot](/images/2023-08-13_16-07-39.png)](/images/2023-08-13_16-07-39.png)

## アプリケーションクライアントシークレットの作成
1. 先ほど登録したアプリケーションを選択し、**詳細画面**に遷移します。
2. **証明書またはシークレットの追加**をクリックします。
3. **新しいクライアントシークレット**をクリックします。
4. **説明**（例：監査用、m365-scan-test用など）および**有効期限**（推奨：180日）を設定し、**追加**をクリックします。
5. 表示された**値**をテキストなどにコピーし保管してください。申請時に必要な情報になります。**【クライアントシークレット欄】**

[![Screenshot](/images/2023-08-13_16-46-45.png)](/images/2023-08-13_16-46-45.png)

## API権限の割り当て
1. 先ほど登録したアプリケーションを選択し、詳細画面に遷移します。
2. **APIアクセス許可の表示**をクリックします。

    [![Screenshot](/images/2023-08-13_16-22-34.png)](/images/2023-08-13_16-22-34.png)

3. **アクセス許可の追加**をクリックし**Microsoft Graph**を選択します。
4. **アプリケーションの許可**を選択し以下のものを追加します。該当のものをすべてチェックし、**アクセス許可の追加**をクリックします。

    * Directory.Read.All
    * User.Read.All
    * Policy.Read.All
    * Reports.Read.All
    * DeviceManagementApps.Read.All
    * Calendars.Read
    * DeviceManagementConfiguration.Read.All
    * SecurityEvents.Read.All

5. 同様に**アクセス許可の追加**をクリックし**Azure Service Management**を選択します。
6. **アプリケーションの許可**を選択し以下のものを追加します。

    * user_impersonation

7. **既定のディレクトリに管理者の同意を与えます＞はい**をクリックします。

    [![Screenshot](/images/2023-08-13_16-43-52.png)](/images/2023-08-13_16-43-52.png)

## 診断用アカウントの作成
1. [Microsoft 365管理センター](https://admin.microsoft.com)に管理者ユーザーでサインインし、**ユーザーの追加**をクリックします。
2. 表示名及びユーザー名に任意の文字列（例：診断用、testなど）を入れ、**次へ**をクリックします。
3. **ユーザーに製品ライセンスを割り当てる**の下のチェックボックスにチェックを入れ、**次へ**をクリックします。
4. 役割の下の管理センターに対するアクセス許可を選択し、**グローバル閲覧者**及び**SharePoint Online管理者**にチェックを入れ、**次へ**をクリックします。

    [![Screenshot](/images/2023-08-13_16-36-25.png)](/images/2023-08-13_16-36-25.png)
    
5. 確認できましたら、**追加の完了**をクリックします。
6. 表示された**ユーザー名**、**パスワード**、**ライセンス名**をテキストなどにコピーし保管してください。申請時に必要な情報になります。**【アカウント欄】【パスワード欄】【契約プラン欄】**

    [![Screenshot](/images/2023-08-13_16-39-23.png)](/images/2023-08-13_16-39-23.png)

